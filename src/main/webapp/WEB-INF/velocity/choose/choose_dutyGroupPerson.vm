#parse("index/_header.vm")
</head>
<body>
	<div class="ui-layout-west" style="border-right:solid 1px #e1e5e6;" id="leftTreeWrap">
    	<div class="ui-layout-north">
    		<div class="k-header k-grid-toolbar" style="padding-left:10px;">班组信息</div>
    	</div>
    	<div class="ui-layout-center">
			<div class="tree">
				<ul id="dutyGroupTree" class="ztree"></ul>
			</div>
    	</div>
	</div>
  
	<div class="ui-layout-center" id="subMain">
    	<div class="ui-layout-north">
			<form class="ui-form" id='pagerForm'>	
				<input id="treeId" type="hidden" name="treeId" value="$!{treeId}">
            	<table width="100%">
    				<tr>
                		<td><table class="ui-search-table"><tr>
                        	
                          	<td class="ui-search-name">人员姓名：</td>
                          	<td class="ui-search-c">
                            	<input  name="personName" value="" class="k-textbox" type="text">
                          	</td>
                          	<td class="ui-search-name first">岗位：</td>
                          	<td class="ui-search-c">
                            	<input name="postDesc" value="" class="k-textbox" type="text">
                         	</td>
                        </tr></table></td>
                    	<td width="150" valign="top" style="padding-top:4px;">
                      		<button type="submit" class="hc_btn k-primary" id="queryBtn"><i class="fa fa-search"></i>查询</button>
                      		<button type="reset" class="hc_btn" id="resetBtn" onclick="cancelLeftTreeSelected();"><i class="fa fa-refresh"></i>重置</button>
                    	</td>
                    	<td></td>
                	</tr>
    			</table>
    		</form>
		</div>
  		<div class="ui-layout-center">
  	  		<div id="grid"></div> 
    	</div>
	</div>	 
#parse("index/_footer.vm") 
<script type="text/javascript">
  var _iframe_layout, _left_layout, _inner_layout;
	$(document).ready(function(){
    _iframe_layout = $('body').layout({
      defaults: {
        resizable: false,
        closable: false,
        spacing_open: 5
      }
    });

    _inner_layout = $("#subMain").layout({
      defaults: {
        resizable: false,
        closable: false,
        spacing_open: 0
      },
      center: {
          onresize_end: function () {
              var grid = $("#grid").data("kendoGrid");
              grid.resize();
          }
      }
    })

    $('#resetBtn').click(function(){
      $("#pagerForm :text").val('');  
    }); 
	
	//列表
    quick_datagrid(
    		"#grid", 
    		"#pagerForm", 
    		"$!{rc.contextPath}/base/dutyGroupPerson/list?t=" + new Date().getTime(),
    		[
    			{field: "id",hidden: true,sortable:false,width:100}, 
    			{field: "personId",hidden: true,sortable:false,width:100}, 
    			{field: "groupId",hidden: true,sortable:false,width:100}, 
    			{field: "personName",title: "姓名",sortable: false,width: 100},
                {field: "postDesc",title: "岗位",sortable: false},
                {field: "groupName",title: "班组",sortable: false,width: 100}, 
    	    ],
      		{sortable: {mode: "multiple",allowUnsort: true},selectable:"multiple, row"},
      		{serverSorting: true}, 
      		[
      			{
              		name: "选择",
              		icon: "fa fa-plus",
              		onclick: function (obj, grid) {
              			var rows = grid.select();
            	        if (null == rows || rows.length == 0) {
            	            notify("你还没有选择!", "warn");
            	            return;
            	        }
						
           				var data = grid.dataItem(rows);
               		    if("$!{dialogId}"!=""){
               		    	    get_el_in_dialog("$!{dialogId}","#$!{txtId}").val(data.personId);
           	        			get_el_in_dialog("$!{dialogId}","#$!{txtName}").val(data.personName);
           						if('$!{groupId}'!=''){
           							get_el_in_dialog("$!{dialogId}","#$!{groupId}").val(data.groupId);
                   					get_el_in_dialog("$!{dialogId}","#$!{groupName}").val(data.groupName);
   						        }
   								resetfocus(get_el_in_dialog("$!{dialogId}","#$!{txtName}"));
   	        			
               			}else{
							if(top.frames[0].window.workerCheckedCallback && "$!{txtId}"=="workerId"){
	                             top.frames[0].window.workerCheckedCallback(data);
	                        }else{
								var id_v = $("#"+"$!{txtId}",window.parent["_main_frame"].document);
       							id_v.val(data.personId);
       							var id_t = $("#"+"$!{txtName}",window.parent["_main_frame"].document);
       							id_t.val(data.personName);
       							resetfocus($("#"+"$!{txtName}",window.parent["_main_frame"].document));
       							if("$!{groupId}"!=""){
       								var id_v = $("#"+"$!{groupId}",window.parent["_main_frame"].document);
       								id_v.val(data.groupId);
       								var id_t = $("#"+"$!{groupName}",window.parent["_main_frame"].document);
       								id_t.val(data.groupName);
       							}
							}
               				
   						}
            			
                	    close_dialog('selectDiloag');
              		}
          		}
				
          	]
      	);
	    
        $("#selectButton").click(function () {
            var ids = new Array();
            var names = new Array();
            var data = $("#grid").getSelectedRows();
            if (data.length == 0) {
                alert("未选择");
                return false;
            } else {
                $.each(data, function (i,p) {
                    ids.push(p.id);
                    names.push(p.name);
                });
                $("#$!{txtId}").val(ids);
                $("#$!{txtName}").val(names);
            	closeDialog();
            }
        });  
        
    });	
	
	/* zTree */
    var setting = {
    	data: {
    		simpleData: {enable: true}
          },
          callback: {
    			onClick: function(event, treeId, treeNode) {
    				 $('#treeId').val(treeNode.id);
    			 	 $('#selectBlock').show();
    				 $('#queryBtn').click();
    			}
    		}
    };
  	var zNodes = [];  
  	zNodes.push({id:"0", pId:"-1", name:"维修班组", open:"true"});
    #foreach($!{treeNode} in $!{dutyGroupList})
		zNodes.push({id:$!{treeNode.id}, pId:$!{treeNode.parentId}, name:"$!{treeNode.groupName}"});
  	#end    

  	$(document).ready(function(){
  		$.fn.zTree.init($("#dutyGroupTree"), setting,zNodes).expandAll(true);
  		var treeId = $("#treeId").val();
		if(treeId!='0'){
			var treeNode = $.fn.zTree.getZTreeObj("dutyGroupTree");
    		var node = treeNode.getNodeByParam("id",treeId,null);
    		if(node){
    			treeNode.selectNode(node);
    		}
		}
  	});
	
	function cancelLeftTreeSelected(){
		$('#treeId').val('');
		$.fn.zTree.init($("#dutyGroupTree"), setting,zNodes);
	}
</script>
</body>
</html>		
