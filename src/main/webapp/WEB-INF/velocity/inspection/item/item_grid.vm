<div id="itemGrid" style="margin-left:-5px;margin-right:5px">
	<input type="hidden" name="itemNumber" value="$!inspectionItem.inspectionItemList.size()" id="itemNumber" />
            <table id='tableId' style="width:100%;" class="ui-table ui-table-addRow">
                <thead>
                    <th class="k-header" align="center">序号</th>
                    <th class="k-header" align="left">项目内容</th>
                    <th class="k-header" align="left">巡检周期</th>
					<th class="k-header" align="left">周期单位</th>
                    <th class="k-header" align="left">巡检班组</th>
                    <th class="k-header" align="left">备注</th>
					#if(!$!viewOnly)
                    <th class="k-header" align="center">
						<a href="javascript:void(0);" id="addRow_item" title="添加行"><i class="fa fa-plus-circle"></i></a>
					</th>
					#end
                </thead>
                <tbody align="center">
                	#set($index=0)
					#set($sy = 1)
			#if($!inspectionItem.inspectionItemList.size() > 0)
		    		#foreach($list in $!inspectionItem.inspectionItemList)
						#set($index = $velocityCount)
						#set($sy = $velocityCount)
		                    <tr>
		                        <td width="5%" style="text-align:center">$velocityCount</td>
		                        <td width="20%"><input  type="text" id="itemContent_id-$index" name="inspectionItemList[$index].itemContent" value="$!{list.itemContent}" class="k-textbox" /></td>
		                        <td width="20%"><input  type="text" id="cycle_id-$index" name="inspectionItemList[$index].cycle" class="k-textbox" value="$!{list.cycle}" /></td>
                	            <td width="20%">
									<select class="k-textbox" id="cycleUnit_id-$index"  name="inspectionItemList[$index].cycleUnit">
										<option value=''>--请选择--</option>
                						#foreach($enumDetail in $!circleUnitList)
                                        <option  value="$!enumDetail.enumValue" #if($!enumDetail.enumValue ==$!{list.cycleUnit}) selected="selected" #end>$!enumDetail.enumText</option>
                						#end
									</select>	
								</td>
		                        <td width="20%">
                	            	<input type="hidden" class="k-textbox"  id="inspectionGroupId_id-$index" name="inspectionItemList[$index].inspectionGroupId" value="$!{list.inspectionGroupId}"/>	            	
                					<span class="k-textbox k-space-right" #if(!$!viewOnly) onclick="chooseGroup('inspectionGroupId_id-$index','inspectionGroupName_id-$index')" #end>
                                    	<input readonly type="text" class="k-textbox"  id="inspectionGroupName_id-$index" name="inspectionItemList[$index].inspectionGroupName" value="$!{list.inspectionGroupName}"/>
                						<a href="#" class="k-icon k-i-search" >&nbsp;</a>
                                	</span>	            	
                	            </td>
		                        <td width="20%"><input  type="text" id="remark_id-$index" name="inspectionItemList[$index].remark" value="$!{list.remark}" class="k-textbox" /></td>
		                        #if($!view)
                				#end
								#if(!$!viewOnly)
								<td>
									<a onclick="delRowItem(this);"  class="del"  href="javascript:void(0);" title="删除"><i class="fa fa-remove spare_delRow" style="color: #000;"></i></a>
								</td>
								#end
		                    </tr>
                    #end
              #else      
						#foreach($j in [$sy..1])
	                        <tr>
	                            <td width="5%" style="text-align:center">$j</td>
	                            <td width="20%"><input  type="text" id="itemContent_id-$j" name="inspectionItemList[$j].itemContent" class="k-textbox" value="" /></td>
	                            <td width="20%"><input  type="text" id="cycle_id-$j" name="inspectionItemList[$j].cycle" class="k-textbox" value="" /></td>
                	            <td width="20%">
									<select class="k-textbox" id="cycleUnits_id-$j"  name="inspectionItemList[$j].cycleUnit">
										<option value=''>--请选择--</option>
                						#foreach($enumDetail in $!circleUnitList)
                                        <option  value="$!enumDetail.enumValue">$!enumDetail.enumText</option>
                						#end
									</select>	
								</td>
								<td width="20%">
                	            	<input type="hidden" class="k-textbox"  id="inspectionGroupId_id-$j" name="inspectionItemList[$j].inspectionGroupId" />	            	
                					<span class="k-textbox k-space-right" onclick="chooseGroup('inspectionGroupId_id-$j','inspectionGroupName_id-$j')">
                                    	<input readonly type="text" class="k-textbox"  id="inspectionGroupName_id-$j" name="inspectionItemList[$j].inspectionGroupName" />
                						<a href="#" class="k-icon k-i-search" >&nbsp;</a>
                                	</span>	            	
                	            </td>
	                            <td width="20%"><input  type="text" id="remark_id-$j" name="inspectionItemList[$j].remark" class="k-textbox" value="" /></td>
	                            #if(!$!viewOnly)
								<td>
									<a onclick="delRowItem(this);" class="del" href="javascript:void(0);" title="删除"><i class="fa fa-close" style="color: #000;"></i></a>
								</td>
								#end
	                        </tr>
                       #end
		 		#end
                </tbody>
            </table>
</div>
	
<script >
    $(document).ready(function(){

    	$("#addRow_item").click(function(){
			var num = $("#itemNumber").val();
			if(num==0)num=1;
			var cur = Number(num);
			var next = cur+1;
			var $tr = $("#itemGrid").find("tr:last");
			var $tmp = $tr;
			var exp = new RegExp("\\["+num+"\\]","g");
			var exps = new RegExp("-"+num,"g");
			var exps1 = new RegExp("_"+num,"g");
			var html = "<tr>"+$($tmp).html().replace(exp,"["+next+"]")+"</tr>";
			html = html.replace(">"+num+"<",">"+next+"<").replace(exps,"-"+next).replace(exps1,"_"+next);
			$("#itemNumber").val(next);
			$($tr).after(html);
			
			$("#itemContent_id-" + next).removeAttr("value");
			$("#cycle_id-" + next).removeAttr("value");
			$("#cycleUnit_id-" + next+' option').removeAttr('selected');
			$("#inspectionGroupId_id-" + next).removeAttr("value");
			$("#inspectionGroupName_id-" + next).removeAttr("value");
			$("#remark_id-" + next).removeAttr("value");
		});
		
    });
	
	function delRowItem(o){
    		var num = $("#itemNumber").val();
    		if(Number(num)==0 || Number(num)==1){
    			num=1;
				#if(!$!view)
    				notify("至少保留一个保养项目", "warn");
				#else
					$("#itemContent_id-" + num).val('');
        			$("#cycleUnit_id-" + num).val('');
        			$("#cycle_id-" + num).val('');
        			$("#inspectionGroupId_id-" + num).val('');
        			$("#inspectionGroupName_id-" + num).val('');
        			$("#remark_id-" + num).val('');
					$("#planTime_id-" + num).val('');
				#end
    		}
    		if(Number(num)!=1){	 
            	var tr = $(o).parent("td").parent("tr");
    			var vs = tr.nextAll();
    			num = Number(tr.find("td:first").html());
    			tr.remove();
    			var next = num+1;
    			$.each(vs,function(i,item){
					var str = $(item).html();
    				var exp = new RegExp("\\["+next+"\\]","g");
        			var exps = new RegExp("-"+next,"g");
        			var html = str.replace(exp,"["+num+"]");
        			html = html.replace(">"+next+"<",">"+num+"<").replace(exps,"-"+num);
    				$(item).html(html);
					num++;next++;
    			})
            	$("#itemNumber").val(num-1);
    		}
		}
		
	function chooseGroup(groupId,groupName){
		if("$!viewOnly" != "true")
		quick_dialog("selectDiloag", "选择", "$!{rc.contextPath}/base/dutyGroup/lookup?txtId="+groupId+"&txtName="+groupName+"&dialogId=inspectionItem_add_dlg", 300, 300);
	}
	
</script>