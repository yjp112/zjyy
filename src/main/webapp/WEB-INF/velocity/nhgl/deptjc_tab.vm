  <script type="text/javascript" src="$!{nhgl_static_hc_url}/js/tabs.min.js"> </script>

  <SCRIPT type="text/javascript">
	$(document).ready(function(){
    	showProgress("span_dept");
    	showProgress("span_dept_list",38);
    	$('#tab-container').tabs();
	   	$('#qy_accordion_dept').accordion({
            "handle": ".handle",
            "panel": ".panel"
       	});
		var standardCode = '$!{fxCode}';
		if(standardCode != ''){
    		$("a[name='sub']").each(function(){
        		$(this).removeClass();
        	});
			$("#"+standardCode).attr("class","current");
		}
		$("#tabBlock").load('$!{rc.contextPath}/nhgl/dept/allYear?fxCode='+standardCode+'&eleTotal='+'$!emt.incremental');
    });
  </SCRIPT>
<div class="nh-header">
	<span class="nh-tab-name">电</span>
	<span class="nh-menu-name">#crumbs("$!menu.code",1)</span>
	<div class="nh-count">
		#if($!emt.tb == 1)
    		<div class="count-item count-item-rise" id="rud">
    	#elseif($!emt.tb == 0)
    		<div class="count-item count-item-unchanged" id="rud">
    	#else
    		<div class="count-item count-item-decline" id="rud">
    	#end
			<div class="item-data">
				<span class="data-num" id="eleTotal">$!emt.incremental</span>
				<span>同比昨日</span>
				#if($!emt.percent>0)
					<span class="data-trend" id="percent">增长$!emt.percent%</span>
				#elseif($!emt.percent==0)
					<span class="data-trend" id="percent">持平</span>
				#else
					<span class="data-trend" id="percent">下降#set($percent = 0-$!emt.percent)$percent%</span>
				#end
			</div>
			<div class="item-ratio">
				<div class="item-ratio-i"></div>
			</div>
			<div class="item-info">
				<span class="info-date">$!emt.sTime</span>
				<span class="info-name" id="deptName">$!deptName 总用电量</span>
			</div>
		</div>
		<!--
		<div class="count-item count-item-decline">
			<div class="item-data">
				<span class="data-num">78,168.54</span>
				<span>同比上月</span>
				<span class="data-trend">下降35%</span>
			</div>
			<div class="item-ratio">
				<div class="item-ratio-i"></div>
			</div>
			<div class="item-info">
				<span class="info-date">2014.07</span>
				<span class="info-name">建筑夜间总用电量</span>
			</div>
		</div>-->
	</div>	
</div>	
<div style="width:300px;float:left;">
	<input id="subId" type="hidden"/>
	<input id="isp" type="hidden"/>
	<input id="name" type="hidden"/>
	<ul id="qy_accordion_dept" class="accordion">
		#foreach($me in $list)
			#if($me.pId == 10001)
				<li name="subli" id="$me.id" isp="1">
					#if($me.tb==1)
						<h3 class="handle handle-rise" onclick="toTab('$!me.name','$!me.id','1',$!me.total)">
					#elseif($me.tb==0)
						<h3 class="handle handle-unchanged" onclick="toTab('$!me.name','$!me.id','1',$!me.total)">
					#else
						<h3 class="handle handle-decline" onclick="toTab('$!me.name','$!me.id','1',$!me.total)">
					#end
					    <span class="handle-name">$!me.name</span>
						<span class="handle-num">$!me.total</span>
						<span class="handle-bar" name="span_dept" num="$!me.total"></span>
					</h3>
					<ul class="panel">
						#foreach($cm in $list)
							#if($!me.id == $!cm.pId)
								#if($cm.tb==1)
									<li name="subli" isp="" id="$cm.id" onclick="toTab('$!cm.name','$!cm.id','',$!cm.total)" class="pitem-rise">
								#elseif($cm.tb==0)
									<li name="subli" isp="" id="$cm.id" onclick="toTab('$!cm.name','$!cm.id','',$!cm.total)" class="pitem-unchanged">
								#else
									<li name="subli" isp="" id="$cm.id" onclick="toTab('$!cm.name','$!cm.id','',$!cm.total)" class="pitem-decline">
								#end
									<a class="pitem-link" href="javascript:;">
										<span class="pitem-name">$!cm.name</span>
                						<span class="pitem-num">$!cm.total</span>
                						<span class="pitem-bar" name="span_dept_list" num="$!cm.total"></span>
									</a>
								</li>
							#end
						#end
					</ul>
				</li>
			#end
		#end
	</ul>
</div>
<div class="nh-content">
	<div class="nh-nd">
		<div class="nh-nd-entry">
			<label>分项能耗：</label>
			<ul class="nh-option">
				<li><a href="#" name="sub" id="" class="current" onclick="subTime('')">全部</a></li>
				##这里使用循环遍历出分项
				#foreach($s in $slist)
					#if($s.parentId == 'code')
						<li><a href="#" name="sub" id="$!{s.standardCode}" onclick="subTime('$!{s.standardCode}')">$s.name</a></li>
					#end
				#end
			</ul>
		</div>
	</div>
	<div id="tabBlock" class="nh-ct">
	</div>
</div>
  
<script type="text/javascript">
	T.nhInit();
	//重新load右边的tab
	function toTab(deptName,id,isp,eleTotal)
	{	
		var subCode="";
		$("a[name='sub']").each(function(){
    		var aStyle = $(this).attr("class");
    		//如果样式为current，则表示被选中
    		if(aStyle == "current")
    			subCode = $(this).attr("id");
		});
		$("#subId").attr("value",id);
		$("#isp").attr("value",isp);
		$("#name").attr("value",deptName);
		if(deptName.length>8)
			deptName = deptName.substring(0,8)+"...";
		$("#deptName").text(deptName+" 总用电量");
		if(eleTotal == 0)
			$("#eleTotal").text("0.00");
		else
			$("#eleTotal").text(eleTotal);
		var menuName = $("#menuName").text();
		$("#tabBlock").load('$!{rc.contextPath}/nhgl/dept/allYear?deptName='+encodeURIComponent(deptName)+'&id='+id+'&isp='+isp+'&fxCode='+subCode+'&eleTotal='+eleTotal+'&menuName='+encodeURI(menuName));
	}
	function subTime(standardCode){
		var subId = $("#subId").val();
		var isp = $("#isp").val();
		var name = $("#name").val();
		//if(subId == '' || standardCode == '')
		$("#chart_content_id").load('$!{rc.contextPath}/nhgl/dept/deptindex?fxCode='+standardCode);
		//else
		//	$("#tabBlock").load('$!{rc.contextPath}/dept/allYear?deptName='+encodeURIComponent(name)+'&id='+subId+'&isp='+isp+'&fxCode='+standardCode);
	}
</script>