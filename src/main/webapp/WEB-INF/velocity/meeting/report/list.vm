#parse("index/_header.vm")
</head>
<body>
	<div class="ui-layout-north">
    <form class="ui-form" id='queryForm'>	
	        <table width="100%">
	          <tr>
		         <td >
		           <table class="ui-search-table" >
	                  <tr>
	                  <td class="ui-search-name first">统计时间：</td>
	                  <td class="ui-search-c" >
						<input id="beginDate_id"  class="k-textbox" type="text" name="meetingDateStart" value="$!{roomInfo.meetingDateStart}" />
						<span class="ui-form-text">至</span> 
						<input class="k-textbox" id="endDate_id" type="text" name="meetingDateEnd" value="$!{roomInfo.meetingDateEnd}" />
	                  </td>
					  <td class="ui-search-name">所属部门：</td>
					  <td>
						<span class="k-textbox k-space-right" onclick="chooseDept('useDepartmentId','useDepartmentName','','')">
							<input readonly class="k-textbox #if(!$!{viewOnly}) ui-input-choose #end" type="text" id="useDepartmentName" name="useDepartmentName" value="$!{meeting.deptName}"  />
							<a href="#" class="k-icon k-i-search">&nbsp;</a>
						</span>
						<input type="hidden" id="useDepartmentId" name="useDeptId" value="$!{meeting.useDeptId}"  />
					  </td>
	            </tr>
		           </table>
		         </td>
	            <td width="150" valign="top" style="padding-top:4px;">
	              <button type="submit" class="hc_btn k-primary" id="queryBtn"><i class="fa fa-search"></i>查询</button>
	              <button type="reset" class="hc_btn" id="resetBtn"><i class="fa fa-refresh"></i>重置</button>
	            </td>
	            <td></td>
	          </tr>
	        </table>
    	</form>
</div>

  <div class="ui-layout-center" id="subMain">
    <div class="ui-layout-north">
    	<div id="graphic_rate_id" style="height:300px">
    	</div>
    </div>
    <div class="ui-layout-center">
  	  <div id="grid" style="display:none;"></div> 
    </div>
  </div>
#parse("index/_footer.vm")  
<script src="$!rc.contextPath/main_static/custom/js/echarts/echarts.js"></script>

<script type="text/javascript">

var myRateChart = null;
var flag = 0;

var _iframe_layout, _left_layout, _inner_layout;
$(document).ready(function(){
_iframe_layout = $('body').layout({
  defaults: {
    resizable: false,
    closable: false,
    spacing_open: 5
  },
  north: {
    size: 0.1
  }
});

_inner_layout = $("#subMain").layout({
    defaults: {
      resizable: false,
      closable: false,
      spacing_open: 0
    },
    north:{
    	size: 0.6
    },
    center: {
        onresize_end: function () {
            var grid = $("#grid").data("kendoGrid");
            grid.resize();
        }
    }
  });
  
  
//列表
quick_datagrid("#grid", "#queryForm", "$!rc.contextPath/meeting/meetingReport/list?r=" + new Date(), [{
          field: "id",
          hidden: true
      }
	  ], 
  {
      sortable: {
          mode: "multiple",
          allowUnsort: true
      },
      pageable:false, 
      showNumber:false,resizable:true
      
  },{
	  change:generateRateChart
  }, {
      serverSorting: true
  });
  
//加载时间控件
commonDateWithout("beginDate_id", "endDate_id", "yyyy-MM-dd", "zh-CN");
	
});

$('#resetBtn').click(function(){
    $("input[name='useDeptId']").val("");
});

//加载chart
function loadEchart(option){
        require.config({
            packages: [
                {
                    name: 'echarts',
                    location: '$!rc.contextPath/main_static/custom/js/echarts',
                    main: 'echarts'
                }
            ]
        });
        require(
                [
                    'echarts',
                    'echarts/chart/line',
                    'echarts/chart/bar'
                ],
                function(ec) {
                	
                    myRateChart = ec.init(document.getElementById('graphic_rate_id'));
                    myRateChart.setOption(option);
                }
        )
    }

    function generateRateChart(grid,g) {

        var roomName = new Array();
        var usedTimes = new Array();
        var usedPercent = new Array();

        var data = grid.items;
        //console.log(data);
        //var rows = data.length;

        $.each(data,function(index,o){
            roomName.push(o.roomName);
            usedTimes.push(o.usedTimes);
            usedPercent.push(o.usedPercent);
        });

        var option = {
			title : {
                text: '会议统计',
                subtext: '次数/占用率',
				x: 'center'
            },
            tooltip : {
                trigger: 'axis'
            },
            calculable : true,
            legend: {
                data:['会议次数','会议占用率'],
				x: 'right'
            },
            xAxis : [
                {
                    type : 'category',
                    data : roomName
                }
            ],
            yAxis : [
                {
                    type : 'value',
                    name : '次数',
                    axisLabel : {
                        formatter: '{value} 次'
                    }
                },
                {
                    type : 'value',
                    name : '百分比',
                    axisLabel : {
                        formatter: '{value} %'
                    }
                }
            ],
            series : [
        
                {
                    name:'会议次数',
                    type:'bar',
                    data:usedTimes
                },
                {
                    name:'会议占用率',
                    type:'line',
                    yAxisIndex: 1,
                    data:usedPercent
                }
            ]
        };

        
        if(myRateChart==null){
            if(data.length!=0)
            	loadEchart(option);//datagrid查询结果为空
        }else{
            if(data.length!=0){
				myRateChart.clear();
                myRateChart.setOption(option);
            }else{
                myRateChart.clear();
            }
        }
    }
	
	/*setTimeout(function(){
		$("#navigate").css("height","25px");
		$(".ui-layout-resizer").css("top","25px");
	},100);
	*/
</script>
</body>
</html>