<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://hc.supconit.com/mybatis-3-mapper.dtd">

<mapper namespace="com.supconit.nhgl.basic.deptConfig.entities.DeptConfig">

	<resultMap type="com.supconit.nhgl.basic.deptConfig.entities.DeptConfig" id="DeptConfigResultMap">      
       <result property="id" column="ID"/>
       <result property="deviceId" column="DEVICE_ID"/>
       <result property="deptId" column="DEPT_ID"/>
       <result property="ftxs" column="FTXS"/>
       <result property="bitNo" column="BIT_NO"/>
       <result property="isSum" column="IS_SUM"/>
       <result property="isSumValue" column="IS_SUMVALUE"/>
       <result property="ruleFlag" column="RULE_FLAG"/>
       <result property="ruleFlagValue" column="RULE_FLAGVALUE"/>
       <result property="nhType" column="NH_TYPE"/>
       <result property="nhTypeValue" column="NH_TYPEVALUE"/>
       <result property="description" column="DESCRIPTION"/>
       <result property="memo" column="MEMO"/>
       <result property="deptName" column="DEPT_NAME"/>
       <result property="extended1" column="EXTENDED1"/>
       <result property="deptCode" column="DEPT_CODE"/>
       <result property="deviceName" column="DEVICE_NAME"/>
       <result property="deviceCode" column="DEVICE_CODE"/>
       <result property="locationName" column="LOCATION_NAME"/>
       <result property="serviceArea" column="serviceArea"/>
       <result property="isSumValue" column="isSumValue"/>
       <result property="hpId" column="HPID"/>
       
       <result property="sumDevice" column="sumDevice"/>
	</resultMap>
	
	<sql id="CURRENT_DATE_TIME">		
		<if test="_databaseId == 'microsoft sql server'">getDate()</if>
	</sql>
	<sql id="count_pre" lang="velocity">
		SELECT
		COUNT(distinct t1.DEPT_ID)
		FROM
		NH_DEPT_CONFIG t1
		LEFT JOIN NH_DEPT t2 ON t1.DEPT_ID = t2.ID
	</sql>
	<sql id="condition_sql" lang="velocity">
	<![CDATA[
		#where()
			#set($_p = $_parameter.condition)
			1=1 		
			#if($_p.id)
				#set($_id = $_p.id)
				AND t1.ID = @{_id,jdbcType=BIGINT}
			#end
			#if($_p.lft)
				#set($_lft = $_p.lft)
				AND t2.LFT >= @{_lft,jdbcType=BIGINT}
			#end
			#if($_p.rgt)
				#set($_rgt = $_p.rgt)
				AND t2.RGT <= @{_rgt,jdbcType=BIGINT}
			#end
			#if($_p.nhType)
				#set($_nhType = $_p.nhType)
				AND t1.NH_TYPE = @{_nhType,jdbcType=BIGINT}
			#end
			#if($_p.deptCode && $_p.deptCode != '')
				#set($_deptCode = '%' + $_p.deptCode + '%')
				AND t2.CODE LIKE @{_deptCode,jdbcType=VARCHAR}
			#end
			#if($_p.deptName && $_p.deptName != '')
				#set($_deptName = '%' + $_p.deptName + '%')
				AND t2.NAME LIKE @{_deptName,jdbcType=VARCHAR}
			#end
			#if($_p.bitNo && $_p.bitNo != '')
				#set($_bitNo = '%' + $_p.bitNo + '%')
				AND t1.BIT_NO LIKE @{_bitNo,jdbcType=VARCHAR}
			#end
			#if($_p.deviceCode && $_p.deviceCode != '')
				#set($_deviceCode = '%' + $_p.deviceCode + '%')
				AND d.DEVICE_CODE LIKE @{_deviceCode,jdbcType=VARCHAR}
			#end	
			
			#if($_p.deviceName && $_p.deviceName != '')
				#set($_deviceName = '%' + $_p.deviceName + '%')
				AND d.DEVICE_NAME LIKE @{_deviceName,jdbcType=VARCHAR}
			#end
		#end
		]]>
	</sql>
	
	<!-- 按条件查询记录-->
	<select id="findByCondition" parameterType="com.supconit.nhgl.basic.deptConfig.entities.DeptConfig" resultMap="DeptConfigResultMap" lang="velocity" databaseId="oracle">
		<include refid="_PUBLIC_V.PAGER_BEFORE"/>
		select
	        MAX(t1.ID) ID,
	        t1.DEPT_ID,
	        CASE  
				when t1.IS_SUM=1 then '是'
			else '否'
			end  isSumValue,
	        func_nhdept_bitno_join(@{_parameter.condition.nhType},t1.DEPT_ID) DESCRIPTION,
	        t2.NAME as DEPT_NAME,
	        t2.CODE DEPT_CODE
        FROM NH_DEPT_CONFIG t1
        LEFT JOIN NH_DEPT t2 ON t1.DEPT_ID = t2.ID
        LEFT JOIN DEVICE d ON t1.DEVICE_ID = d.ID
		<include refid="condition_sql"/>
		group by t1.DEPT_ID,t2.NAME,t2.CODE,t1.IS_SUM
		#order($_parameter.condition,"t1.DEPT_ID")
		<include refid="_PUBLIC_V.PAGER_AFTER"/>
	</select>
	<select id="findByCondition" parameterType="com.supconit.nhgl.basic.deptConfig.entities.DeptConfig" resultMap="DeptConfigResultMap" lang="velocity" databaseId="sqlserver">
		<include refid="_PUBLIC_V.PAGER_BEFORE"/>
		select
	        MAX(t1.ID) ID,
	        t1.DEPT_ID,
	        CASE  
				when t1.IS_SUM=1 then '是'
			else '否 '
			end  isSumValue,
	        dbo.func_nhdept_bitno_join(@{_parameter.condition.nhType},t1.DEPT_ID) DESCRIPTION,
	        t2.NAME as DEPT_NAME,
	        t2.CODE DEPT_CODE
		<include refid="_PUBLIC_V.ROW_NUMBER_OVER" /> 
		#order($_parameter.condition,"t1.DEPT_ID")
 		<include refid="_PUBLIC_V.AS_ROW_NUM" />	        
        FROM NH_DEPT_CONFIG t1
        LEFT JOIN NH_DEPT t2 ON t1.DEPT_ID = t2.ID
        LEFT JOIN DEVICE d ON t1.DEVICE_ID = d.ID
		<include refid="condition_sql"/>
		group by t1.DEPT_ID,t2.NAME,t2.CODE,t1.IS_SUM
		<include refid="_PUBLIC_V.PAGER_AFTER"/>
	</select>
	<select id="countByCondition" parameterType="com.supconit.nhgl.basic.deptConfig.entities.DeptConfig" resultType="long" lang="velocity">
		<include refid="count_pre"/>
		<include refid="condition_sql"/>
	</select>
	<!-- 按条件查询记录-->
	<select id="findUnusedDevice" parameterType="com.supconit.nhgl.basic.deptConfig.entities.DeptConfig" resultMap="DeptConfigResultMap" lang="velocity" databaseId="oracle">
		<include refid="_PUBLIC_V.PAGER_BEFORE"/>
		select d.*,a.area_name serviceArea from 
		(select extended1  from device 
			minus
		 select bit_no from nh_dept_config 
		where nh_type=@{_parameter.condition.nhType} and rule_flag=1 group by bit_no ) t1
		LEFT JOIN DEVICE d ON t1.extended1 = d.extended1
		left join device_category dc on d.CATEGORY_ID=dc.id
		left join nh_area a on d.service_area_id=a.id
		where dc.category_code=@{_parameter.condition.categoryCode,jdbcType=VARCHAR}
		#order($_parameter.condition,"d.id")
		<include refid="_PUBLIC_V.PAGER_AFTER"/>
	</select>
	<select id="findUnusedDevice" parameterType="com.supconit.nhgl.basic.deptConfig.entities.DeptConfig" resultMap="DeptConfigResultMap" lang="velocity" databaseId="sqlserver">
		<include refid="_PUBLIC_V.PAGER_BEFORE"/>
		select d.*,a.area_name serviceArea 
		<include refid="_PUBLIC_V.ROW_NUMBER_OVER" /> 
		#order($_parameter.condition,"d.id")
 		<include refid="_PUBLIC_V.AS_ROW_NUM" />
		from 
		(select extended1  from device 
			except
		 select bit_no from nh_dept_config 
		where nh_type=@{_parameter.condition.nhType} and rule_flag=1 group by bit_no ) t1
		LEFT JOIN DEVICE d ON t1.extended1 = d.extended1
		left join device_category dc on d.CATEGORY_ID=dc.id
		left join nh_area a on d.service_area_id=a.id
		where dc.category_code=@{_parameter.condition.categoryCode,jdbcType=VARCHAR}
		<include refid="_PUBLIC_V.PAGER_AFTER"/>
	</select>
	<select id="countUnusedDevice" parameterType="com.supconit.nhgl.basic.deptConfig.entities.DeptConfig" resultType="long" lang="velocity" databaseId="sqlserver">
		select count(1)
		from 
		(select extended1  from device 
			except
		 select bit_no from nh_dept_config 
		where nh_type=@{_parameter.condition.nhType} and rule_flag=1 group by bit_no) t1
		LEFT JOIN DEVICE d ON t1.extended1 = d.extended1
		left join device_category dc on d.CATEGORY_ID=dc.id
		where dc.category_code=@{_parameter.condition.categoryCode}
	</select>
	<select id="countUnusedDevice" parameterType="com.supconit.nhgl.basic.deptConfig.entities.DeptConfig" resultType="long" lang="velocity" databaseId="oracle">
		select count(1)
		from 
		(select extended1  from device 
			minus
		 select bit_no from nh_dept_config 
		where nh_type=@{_parameter.condition.nhType} and rule_flag=1 group by bit_no) t1
		LEFT JOIN DEVICE d ON t1.extended1 = d.extended1
		left join device_category dc on d.CATEGORY_ID=dc.id
		where dc.category_code=@{_parameter.condition.categoryCode}
	</select>
	<select id="findDeptIds" parameterType="string" resultType="Long">
      select distinct DEPT_ID
        FROM NH_DEPT_CONFIG N
        where N.NH_TYPE=#{nhType}
    </select>
	<select id="findById" parameterType="Map" resultMap="DeptConfigResultMap" lang="velocity">
      select
	        t1.ID,
	        t1.DEVICE_ID,
	        t1.DEPT_ID,
	        t1.FTXS,
	        t1.IS_SUM,
	        t1.BIT_NO,
	        t1.RULE_FLAG,
	        t1.NH_TYPE,
	        #if($_databaseId=='oracle')
	        	func_nhdept_bitno_join(@{_parameter.nhType,jdbcType=NUMERIC},t1.DEPT_ID) DESCRIPTION,
	        #else
	        	dbo.func_nhdept_bitno_join(@{_parameter.nhType,jdbcType=NUMERIC},t1.DEPT_ID) DESCRIPTION,
	        #end
	        t1.MEMO,
	        t2.NAME as DEPT_NAME,
	        t2.CODE DEPT_CODE
        FROM NH_DEPT_CONFIG t1
        LEFT JOIN NH_DEPT t2 ON t1.DEPT_ID = t2.ID
        where t1.ID = @{_parameter.id,jdbcType=NUMERIC}
    </select>
	<select id="findErrorIsSum" parameterType="String" resultMap="DeptConfigResultMap">
        select count(BIT_NO) sumDevice,dept_id,is_sum 
		from Nh_Dept_Config t where nh_type=#{nhType}
		group by dept_id,is_sum
    </select>
	<select id="findByDeptIdAndRule" parameterType="Map" resultMap="DeptConfigResultMap">
      select
      		t1.ID,
	        t1.DEVICE_ID,
	        t1.FTXS,
	        t1.BIT_NO,
	        t2.DEVICE_NAME,
	        t2.EXTENDED1,
	        t2.DEVICE_CODE,
	        t2.LOCATION_NAME
        FROM NH_DEPT_CONFIG t1
        LEFT JOIN DEVICE t2 ON t1.DEVICE_ID = t2.ID
        where t1.DEPT_ID = #{deptId} 
        <if test="ruleFlag!=null" >and t1.RULE_FLAG=#{ruleFlag} </if>
        and t1.NH_TYPE=#{nhType}
    </select>
	<!-- 按条件查询记录-->
	<select id="findRepeatDevice" parameterType="com.supconit.nhgl.basic.deptConfig.entities.DeptConfig" resultMap="DeptConfigResultMap" lang="velocity" databaseId="oracle">
		<include refid="_PUBLIC_V.PAGER_BEFORE"/>
      select d.device_code,d.device_name,a.area_name serviceArea from 
      (select
	        t1.BIT_NO
        FROM NH_DEPT_CONFIG t1
        where 
        	 t1.RULE_FLAG=1
        	and t1.NH_TYPE=@{_parameter.condition.nhType}) a1
      inner join
      (select
	        t1.BIT_NO
        FROM NH_DEPT_CONFIG t1
        where 
        	 t1.RULE_FLAG=0
        	and t1.NH_TYPE=@{_parameter.condition.nhType}) a2
       on a1.bit_no=a2.bit_no
       left join device d on d.EXTENDED1=a1.bit_no
       left join nh_area a on d.service_area_id=a.id
		#order($_parameter.condition,"a1.bit_no")
		<include refid="_PUBLIC_V.PAGER_AFTER"/>
	</select>
	<select id="findRepeatDevice" parameterType="com.supconit.nhgl.basic.deptConfig.entities.DeptConfig" resultMap="DeptConfigResultMap" lang="velocity" databaseId="sqlserver">
		<include refid="_PUBLIC_V.PAGER_BEFORE"/>
		select d.device_code,d.device_name,a.area_name serviceArea
		<include refid="_PUBLIC_V.ROW_NUMBER_OVER" /> 
		#order($_parameter.condition,"a1.bit_no")
 		<include refid="_PUBLIC_V.AS_ROW_NUM" />
		from 
		(select
	        t1.BIT_NO
        FROM NH_DEPT_CONFIG t1
        where 
        	 t1.RULE_FLAG=1
        	and t1.NH_TYPE=@{_parameter.condition.nhType}) a1
      inner join
      (select
	        t1.BIT_NO
        FROM NH_DEPT_CONFIG t1
        where 
        	 t1.RULE_FLAG=0
        	and t1.NH_TYPE=@{_parameter.condition.nhType}) a2
       on a1.bit_no=a2.bit_no
       left join device d on d.EXTENDED1=a1.bit_no
       left join nh_area a on d.service_area_id=a.id
		<include refid="_PUBLIC_V.PAGER_AFTER"/>
	</select>
	<select id="countRepeatDevice" parameterType="com.supconit.nhgl.basic.deptConfig.entities.DeptConfig" resultType="long" lang="velocity" databaseId="sqlserver">
		select count(1)
		(select
	        t1.BIT_NO
        FROM NH_DEPT_CONFIG t1
        where t1.RULE_FLAG=1
        	and t1.NH_TYPE=@{_parameter.condition.nhType}) a1
      inner join
      (select
	        t1.BIT_NO
        FROM NH_DEPT_CONFIG t1
        where  t1.RULE_FLAG=0
        	and t1.NH_TYPE=@{_parameter.condition.nhType}) a2
       on a1.bit_no=a2.bit_no
       left join device d on d.EXTENDED1=a1.bit_no
	</select>    
	<!-- 按条件查询记录-->
	<select id="findErrorFtxs" parameterType="com.supconit.nhgl.basic.deptConfig.entities.DeptConfig" resultMap="DeptConfigResultMap" lang="velocity" databaseId="oracle">
		<include refid="_PUBLIC_V.PAGER_BEFORE"/>
        select d.device_code,d.device_name,a1.area_name serviceArea
        from 
		  (select
	        t1.BIT_NO,dept_id
        FROM NH_DEPT_CONFIG t1
        where
         t1.RULE_FLAG=1
        and t1.NH_TYPE=@{_parameter.condition.nhType}
        group by bit_no,dept_id
        having sum(ftxs)!=1) a 
        left join device d on a.bit_no=d.extended1
        left join nh_area a1 on d.service_area_id=a1.id
		#order($_parameter.condition,"a.bit_no")
		<include refid="_PUBLIC_V.PAGER_AFTER"/>
	</select>
	<select id="findErrorFtxs" parameterType="com.supconit.nhgl.basic.deptConfig.entities.DeptConfig" resultMap="DeptConfigResultMap" lang="velocity" databaseId="sqlserver">
		<include refid="_PUBLIC_V.PAGER_BEFORE"/>
		select d.device_code,d.device_name,a1.area_name serviceArea
		<include refid="_PUBLIC_V.ROW_NUMBER_OVER" /> 
		#order($_parameter.condition,"a.bit_no")
 		<include refid="_PUBLIC_V.AS_ROW_NUM" /> from
		(select
	        t1.BIT_NO,dept_id
        FROM NH_DEPT_CONFIG t1
        where  
         t1.RULE_FLAG=1
        and t1.NH_TYPE=@{_parameter.condition.nhType}
        group by bit_no,dept_id
        having sum(ftxs)!=1) a 
        left join device d on a.bit_no=d.extended1
        left join nh_area a1 on d.service_area_id=a1.id
		<include refid="_PUBLIC_V.PAGER_AFTER"/>
	</select>
	<select id="countErrorFtxs" parameterType="com.supconit.nhgl.basic.deptConfig.entities.DeptConfig" resultType="long" lang="velocity" databaseId="sqlserver">
		select count(1)
		from
		(select
	        t1.BIT_NO,dept_id
        FROM NH_DEPT_CONFIG t1
        where t1.RULE_FLAG=1
        and t1.NH_TYPE=@{_parameter.condition.nhType}
        group by bit_no,dept_id
        having sum(ftxs)!=1) a 
        left join device d on a.bit_no=d.extended1
	</select>    
    
    <!-- 更新记录-->
	<update id="update" parameterType="com.supconit.nhgl.basic.deptConfig.entities.DeptConfig">
		UPDATE	NH_DEPT_CONFIG
		<set>
        <if test="deviceId != null">DEVICE_ID = #{deviceId,jdbcType=NUMERIC},</if>
        <if test="deptId !=null">DEPT_ID=#{deptId,jdbcType=NUMERIC},</if>
        <if test="ftxs !=null">FTXS=#{ftxs,jdbcType=NUMERIC},</if>
        <if test="bitNo !=null">BIT_NO=#{bitNo,jdbcType=VARCHAR},</if>
        <if test="isSum !=null">IS_SUM=#{isSum,jdbcType=NUMERIC},</if>
        <if test="ruleFlag !=null">RULE_FLAG=#{ruleFlag,jdbcType=NUMERIC},</if>
        <if test="nhType !=null">NH_TYPE=#{nhType,jdbcType=NUMERIC},</if>
<!--         <if test="description !=null">DESCRIPTION=#{description,jdbcType=VARCHAR},</if> -->
        <if test="memo !=null">MEMO=#{memo,jdbcType=VARCHAR}</if>
		</set>
		WHERE ID = #{id}
	</update>
 	<sql id="TABLE_NAME" lang="velocity">NH_DEPT_CONFIG</sql>
	<sql id="SEQUENCE" lang="velocity">SELECT SEQ_<include refid="TABLE_NAME"/>.NEXTVAL FROM DUAL</sql>	
	<sql id="INSERT_SQL" lang="velocity">
		INSERT INTO <include refid="TABLE_NAME"/>
		(
		#if($_databaseId=='oracle') ID,#end   
		DEVICE_ID,
        DEPT_ID,
        FTXS,
        BIT_NO,
        IS_SUM,
        RULE_FLAG,
        NH_TYPE,
<!--         DESCRIPTION, -->
        MEMO
        ) VALUES (        
		 #if($_databaseId == 'oracle') @{_parameter.id,jdbcType=NUMERIC},#end
			@{_parameter.deviceId,jdbcType=NUMERIC},
			@{_parameter.deptId,jdbcType=NUMERIC},
			@{_parameter.ftxs,jdbcType=NUMERIC},
			@{_parameter.bitNo,jdbcType=VARCHAR},
			@{_parameter.isSum,jdbcType=NUMERIC},
			@{_parameter.ruleFlag,jdbcType=NUMERIC},
			@{_parameter.nhType,jdbcType=NUMERIC},
<!-- 			@{_parameter.description,jdbcType=VARCHAR}, -->
			@{_parameter.memo,jdbcType=VARCHAR}
		)
	</sql>
	
	<insert id="insert" parameterType="com.supconit.nhgl.basic.deptConfig.entities.DeptConfig" keyProperty="id" keyColumn="ID" lang="velocity" databaseId="sqlserver">
        <include refid="INSERT_SQL"/>
        <selectKey keyProperty="id" resultType="long" order="AFTER"><include refid="_PUBLIC_V.SELECT_KEY"/> </selectKey>
    </insert>
    <insert id="insert" parameterType="com.supconit.nhgl.basic.deptConfig.entities.DeptConfig" 
		keyProperty="id" keyColumn="ID" 		lang="velocity" databaseId="oracle">
		<selectKey keyProperty="id" resultType="long" order="BEFORE">
			<include refid="SEQUENCE" />
		</selectKey>        
		<include refid="INSERT_SQL" />
	</insert>    
	
	<delete id="deleteById" parameterType="Long">
		DELETE FROM NH_DEPT_CONFIG WHERE ID = #{id}
	</delete>
	<delete id="deleteByDeptId" parameterType="map">
		DELETE FROM NH_DEPT_CONFIG WHERE DEPT_ID = #{deptId} 
		and NH_TYPE=#{nhType}
	</delete>
	
	<!-- 删除多条记录-->
	 <delete id="deleteByIds">
        DELETE FROM NH_DEPT_CONFIG WHERE ID in 
		<foreach item="item" index="index" collection="ids" open="(" separator="," close=")">
			#{item}
		</foreach>
	</delete>
	
	<select id="countFindAll" parameterType="com.supconit.nhgl.basic.deptConfig.entities.DeptConfig" resultType="int"  lang="velocity">
		SELECT count(1) from NH_DEPT_CONFIG where DEPT_ID=@{_parameter.deptId} and  NH_TYPE = @{_parameter.nhType}
	</select>
	<select id="getByDeptId" parameterType="long" resultType="long"  lang="velocity">
		SELECT count(1) from NH_DEPT_CONFIG where DEPT_ID=@{_parameter,jdbcType=NUMERIC}
	</select>
	
	<select id="findAllDevicesWithOutRoot" resultMap="DeptConfigResultMap" lang="velocity">
		SELECT ID DEVICE_ID,HPID from DEVICE where ID>0
	</select>
	
	<select id="findAllDept" resultMap="DeptConfigResultMap" lang="velocity">
		SELECT ID DEPT_ID,CODE DEPT_CODE,NAME DEPT_NAME from NH_DEPT
	</select>
	
	<select id="findAllDeptConfig" parameterType="com.supconit.nhgl.basic.deptConfig.entities.DeptConfig" resultMap="DeptConfigResultMap" lang="velocity">
			SELECT
		t1.DEPT_ID as ID ,
		t2.NAME  as DEPT_NAME,
		t2.CODE as DEPT_CODE,
		t1.IS_SUM ,
		CASE
	WHEN t1.IS_SUM = 1 THEN
		'是'
	when  t1.IS_SUM = 0 THEN
		'否'
	ELSE
		null
	END AS IS_SUMVALUE ,
		t1.BIT_NO ,
		t1.FTXS,
		T1.RULE_FLAG  ,
	case 
	when t1.RULE_FLAG=1 THEN
	'加' 
	when t1.RULE_FLAG=0  then
	'减'
	ELSE
	null
	END  as RULE_FLAGVALUE,
	t1.NH_TYPE,
	case when t1.nh_type=1 THEN
	'电'
	when t1.NH_Type=2 then 
	'水'
	when t1.NH_Type=3 then 
	'蒸汽'
	when t1.NH_Type=4 then 
	'能量'
	else NULL
	end as NH_TYPEVALUE,
	t1.MEMO,
	d.DEVICE_NAME
	FROM
		NH_DEPT_CONFIG t1
	LEFT JOIN NH_DEPT t2 ON t1.DEPT_ID = t2.ID left JOIN DEVICE d ON d.HPID = t1.BIT_NO
	where t1.NH_TYPE = @{_parameter.nhType}
	order by t2.id asc,t2.CODE asc  
	</select>

	<delete id="deleteByDeptIdAndNhtype">
        DELETE FROM NH_DEPT_CONFIG WHERE NH_TYPE = #{nhType} and DEPT_ID in 
		<foreach item="item" index="index" collection="ids" open="(" separator="," close=")">
			#{item}
		</foreach>
	</delete>
	
	<delete id="deleteAll">
        DELETE FROM NH_DEPT_CONFIG
	</delete>
	
	<select id="findDevicesMapWithOutRoot" resultMap="DeptConfigResultMap" lang="velocity">
		SELECT 
			t.HPID,
			d.CATEGORY_CODE nhTypeValue
		from DEVICE t 
		left join DEVICE_CATEGORY d ON t.CATEGORY_ID = d.ID
		where t.ID>0
	</select>
</mapper>