<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://hc.supconit.com/mybatis-3-mapper.dtd">
<mapper namespace="com.supconit.repair.entities.RepairReportNum">
    <resultMap id="RepairReportNumResultMap" type="com.supconit.repair.entities.RepairReportNum">
        <result column="repair_times" property="repairTimes"/>
        <result column="repair_finish_times" property="repairFinishTimes"/>
        <result column="repair_month" property="repairMonth"/>
        <result column="repair_day" property="repairDay"/>
    </resultMap>
    
    <select id="queryRepairByYearFinished" resultMap="RepairReportNumResultMap" parameterType="com.supconit.repair.entities.RepairReportNum">
		select count(A.ID) repair_finish_times,to_char(a.ACTUAL_FINISH_TIME,'yyyy-mm') repair_month 
		FROM REPAIR A
		WHERE A.ACTUAL_FINISH_TIME IS NOT NULL 
        <if test="repairYear!=null and repairYear!='' ">
            and to_char(a.ACTUAL_FINISH_TIME,'yyyy') = #{repairYear}
        </if>
        group by to_char(a.ACTUAL_FINISH_TIME,'yyyy-mm')
        order by to_char(a.ACTUAL_FINISH_TIME,'yyyy-mm')
    </select>
    <select id="queryRepairByYearAll" resultMap="RepairReportNumResultMap" parameterType="com.supconit.repair.entities.RepairReportNum">
		select count(A.ID) repair_times,to_char(a.CREATE_DATE,'yyyy-mm') repair_month 
		FROM REPAIR A
		WHERE 1=1 
        <if test="repairYear!=null  and repairYear!='' ">
            and to_char(a.CREATE_DATE,'yyyy') = #{repairYear}
        </if>
        group by to_char(a.CREATE_DATE,'yyyy-mm')
        order by to_char(a.CREATE_DATE,'yyyy-mm')
    </select>
    
    <select id="queryRepairByMonthFinished" resultMap="RepairReportNumResultMap" parameterType="com.supconit.repair.entities.RepairReportNum">
		select count(A.ID) repair_finish_times,to_char(a.ACTUAL_FINISH_TIME,'yyyy-mm-dd') repair_day 
		FROM REPAIR A
		WHERE A.ACTUAL_FINISH_TIME IS NOT NULL 
        <if test="repairMonth!=null and repairMonth!='' ">
            and to_char(a.ACTUAL_FINISH_TIME,'yyyy-mm') = #{repairMonth}
        </if>
        group by to_char(a.ACTUAL_FINISH_TIME,'yyyy-mm-dd')
        order by to_char(a.ACTUAL_FINISH_TIME,'yyyy-mm-dd')
    </select>
    
    <select id="queryRepairByMonthAll" resultMap="RepairReportNumResultMap" parameterType="com.supconit.repair.entities.RepairReportNum">
		select count(A.ID) repair_times,to_char(a.CREATE_DATE,'yyyy-mm-dd') repair_day 
		FROM REPAIR A
		WHERE 1=1 
        <if test="repairMonth!=null and repairMonth!='' ">
            and to_char(a.CREATE_DATE,'yyyy-mm') = #{repairMonth}
        </if>
        group by to_char(a.CREATE_DATE,'yyyy-mm-dd')
        order by to_char(a.CREATE_DATE,'yyyy-mm-dd')
    </select>
</mapper>
