<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://hc.supconit.com/mybatis-3-mapper.dtd">
<mapper namespace="com.supconit.repair.entities.RepairReportBySpare">
    <resultMap id="repairReportBySpareResultMap" type="com.supconit.repair.entities.RepairReportBySpare">
        <result column="qty" property="qty"/>
        <result column="spare_name" property="spareName"/>
        <result column="startTime" property="startTime"/>
        <result column="endTime" property="endTime"/>
        <result column="categoryId" property="categoryId"/>
        <result column="repair_mode" property="repairMode"/>
    </resultMap>
    <select id="queryRepairBySpare" resultMap="repairReportBySpareResultMap" parameterType="com.supconit.repair.entities.RepairReportBySpare">
		select sum(a.qty) qty,a.spare_name 
		from REPAIR_SPARE a
		left join repair b on a.repair_code=b.repair_code
		left join device c on b.device_id=c.id
		WHERE b.ACTUAL_FINISH_TIME IS NOT NULL and a.spare_name is not null
        <if test="null!=startTime and ''!=startTime ">
            and b.ACTUAL_FINISH_TIME > #{startTime}
        </if>
        <if test="null!=endTime and ''!=endTime">
            <![CDATA[ and b.ACTUAL_FINISH_TIME <= #{endTime} ]]>
        </if>
        <if test="null!=categoryId and ''!=categoryId ">
            and c.category_id = #{category_id}
        </if>
        <if test="null != repairMode">
            and b.repair_mode = #{repairMode}
        </if>
        group by a.spare_name
    </select>
</mapper>
